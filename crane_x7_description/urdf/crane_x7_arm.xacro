<?xml version="1.0"?>

<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:property name="M_PI" value="3.14159"/>
  <xacro:property name="SCALE_MM" value="0.001"/>
  <xacro:property name="SCALE_CM" value="0.01"/>

  <xacro:property name="BASE_FIXED_PART_HEIGHT" value="0.005"/>

  <!-- Macro for the standard CRANE X7 configuration -->
  <xacro:macro name="crane_x7_arm"
      params="parent
              end_effector_base_link
              base_color
              shoulder_color
              shoulder_joint_cover_color
              upper_arm_upper_color
              upper_arm_lower_color
              elbow_joint_cover_color
              lower_arm_upper_color
              lower_arm_lower_color
              wrist_color
              joints_vlimit
              shoulder_llimit
              shoulder_ulimit
              *origin">

    <!-- Shoulder -->
    <crane_x7_base
        parent="${parent}"
        name="crane_x7_shoulder"
        fixed_part_color="${base_color}"
        pan_vlimit="${joints_vlimit}"
        pan_llimit="${shoulder_llimit}"
        pan_ulimit="${shoulder_ulimit}"
        revolute_part_color="${shoulder_color}"
        tilt_vlimit="${joints_vlimit}"
        tilt_llimit="${M_PI/2}"
        tilt_ulimit="${M_PI/2}"
        attached_link="crane_x7_upper_arm_fixed_part_link">
      <xacro:insert_block name="origin"/>
    </crane_x7_base>

    <!-- Upper arm -->
    <crane_x7_type_1_rotating_link
        name="crane_x7_upper_arm"
        fixed_part_color="${upper_arm_upper_color}"
        fixed_vlimit="${joints_vlimit}"
        fixed_llimit="-${M_PI/2}"
        fixed_ulimit="${M_PI/2}"
        revolute_part_color="${upper_arm_lower_color}"
        revolute_vlimit="${joints_vlimit}"
        revolute_llimit="-${M_PI/2}"
        revolute_ulimit="${M_PI/2}"
        joint_cover_color="${shoulder_joint_cover_color}"
        attached_link="crane_x7_lower_arm_fixed_part_link">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </crane_x7_type_1_rotating_link>

    <!-- Lower arm -->
    <crane_x7_type_2_rotating_link
        name="crane_x7_lower_arm"
        fixed_part_color="${lower_arm_upper_color}"
        fixed_vlimit="${joints_vlimit}"
        fixed_llimit="-${M_PI/2}"
        fixed_ulimit="${M_PI/2}"
        revolute_part_color="${lower_arm_lower_color}"
        revolute_vlimit="${joints_vlimit}"
        revolute_llimit="-${M_PI/2}"
        revolute_ulimit="${M_PI/2}"
        joint_cover_color="${elbow_joint_cover_color}"
        attached_link="crane_x7_wrist_link">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </crane_x7_type_2_rotating_link>

    <!-- Wrist -->
    <crane_x7_wrist
        name="crane_x7_wrist"
        color="${wrist_color}"
        vlimit="${joints_vlimit}"
        llimit="-${M_PI/2}"
        ulimit="${M_PI/2}"
        attached_link="${end_effector_base_link}">
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </crane_x7_wrist>
  </xacro:macro>


  <!-- Composite parts -->
  <!-- Base pan/tilt-like joint -->
  <xacro:macro name="crane_x7_base"
      params="parent name
      fixed_part_color pan_vlimit pan_llimit pan_ulimit
      revolute_part_color tilt_vlimit tilt_llimit tilt_ulimit attached_link *origin">
    <crane_x7_base_fixed_part
        parent="${parent}"
        name="${name}_fixed_part"
        color="${fixed_part_color}"
        vlimit="${pan_vlimit}"
        llimit="${pan_llimit}"
        ulimit="${pan_ulimit}"
        attached_link="${name}_revolute_part_link">
      <xacro:insert_block name="origin"/>
    </crane_x7_base_fixed_part>

    <crane_x7_base_revolute_part
        name="${name}_revolute_part"
        color="${revolute_part_color}"
        vlimit="${tilt_vlimit}"
        llimit="${tilt_llimit}"
        ulimit="${tilt_ulimit}"
        attached_link="${attached_link}">
      <xacro:insert_block name="origin"/>
    </crane_x7_base_revolute_part>
  </xacro:macro>

  <!-- Long link with twist capability -->
  <xacro:macro name="crane_x7_type_1_rotating_link"
      params="name
      fixed_part_color fixed_vlimit fixed_llimit fixed_ulimit
      revolute_part_color revolute_vlimit revolute_llimit revolute_ulimit
      joint_cover_color attached_link *origin">
    <crane_x7_rotating_link_1_fixed_part
        name="${name}_fixed_part"
        color="${fixed_part_color}"/>

    <crane_x7_rotating_link_1_revolute_part
        parent="${name}_fixed_part_link"
        name="${name}_revolute_part"
        color="${revolute_part_color}"
        rotate_vlimit="${fixed_vlimit}"
        rotate_llimit="${fixed_llimit}"
        rotate_ulimit="${fixed_ulimit}"
        twist_vlimit="${revolute_vlimit}"
        twist_llimit="${revolute_llimit}"
        twist_ulimit="${revolute_ulimit}"
        joint_cover_color="${joint_cover_color}"
        attached_link="${attached_link}">
      <xacro:insert_block name="origin"/>
    </crane_x7_rotating_link_1_revolute_part>
  </xacro:macro>

  <!-- Arm-to-wrist link with twist capability -->
  <xacro:macro name="crane_x7_type_2_rotating_link"
      params="name
      fixed_part_color fixed_vlimit fixed_llimit fixed_ulimit
      revolute_part_color revolute_vlimit revolute_llimit revolute_ulimit
      joint_cover_color attached_link *origin">
    <crane_x7_rotating_link_2_fixed_part
        name="${name}_fixed_part"
        color="${fixed_part_color}"
        vlimit="${fixed_vlimit}"
        llimit="${fixed_llimit}"
        ulimit="${fixed_ulimit}"
        attached_link="${name}_revolute_part_link">
      <xacro:insert_block name="origin"/>
    </crane_x7_rotating_link_2_fixed_part>

    <crane_x7_rotating_link_2_revolute_part
        name="${name}_revolute_part"
        color="${revolute_part_color}"
        vlimit="${revolute_vlimit}"
        llimit="${revolute_llimit}"
        ulimit="${revolute_ulimit}"
        joint_cover_color="${joint_cover_color}"
        attached_link="${attached_link}">
      <xacro:insert_block name="origin"/>
    </crane_x7_rotating_link_2_revolute_part>
  </xacro:macro>


  <!-- Individual parts -->

  <!-- Mountable part of base -->
  <xacro:macro name="crane_x7_base_fixed_part"
      params="parent name color vlimit llimit ulimit attached_link *origin">
    <!-- Fixed joint to the mounting point -->
    <joint name="${name}_mount_joint" type="fixed">
      <xacro:insert_block name="origin"/>
      <parent link="${parent}"/>
      <child link="${name}_link"/>
    </joint>

    <!-- Main link -->
    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/base_fixed_part.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/base_fixed_part.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>

    <!-- Pan joint of the shoulder -->
    <joint name="${name}_pan_joint" type="revolute">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit effort="30" velocity="${vlimit}" lower="${llimit}" upper="${ulimit}"/>
      <parent link="${name}_link"/>
      <child link="${attached_link}"/>
    </joint>
  </xacro:macro>

  <!-- Rotated part of base -->
  <xacro:macro name="crane_x7_base_revolute_part"
      params="name color vlimit llimit ulimit attached_link *origin">
    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/base_revolute_part.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/base_revolute_part.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>

    <!-- Tilt joint of the shoulder -->
    <joint name="${name}_tilt_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <axis xyz="0 1 0"/>
      <limit effort="30" velocity="${vlimit}" lower="${llimit}" upper="${ulimit}"/>
      <parent link="${name}_link"/>
      <child link="${attached_link}"/>
    </joint>
  </xacro:macro>

  <!-- "Fixed" part of long twistable link -->
  <xacro:macro name="crane_x7_rotating_link_1_fixed_part"
    params="name color">
    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/rotating_link_type_1_fixed_part.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/rotating_link_type_1_fixed_part.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>
  </xacro:macro>

  <!-- Rotating part of long twistable link -->
  <xacro:macro name="crane_x7_rotating_link_1_revolute_part"
      params="parent name color rotate_vlimit rotate_llimit rotate_ulimit
        twist_vlimit twist_llimit twist_ulimit joint_cover_color attached_link *origin">
    <!-- Joint for rotating around long axis -->
    <joint name="${name}_twist_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <axis xyz="0 0 1"/>
      <limit effort="30"
          velocity="${rotate_vlimit}"
          lower="${rotate_llimit}"
          upper="${rotate_ulimit}"/>
      <parent link="${parent}"/>
      <child link="${name}_link"/>
    </joint>

    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/rotating_link_type_1_revolute_part.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/joint_cover.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${joint_cover_color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/rotating_link_type_1_revolute_part.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/joint_cover.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>

    <!-- Joint for rotating the attached part -->
    <joint name="${name}_rotate_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <axis xyz="0 0 1"/>
      <limit effort="30"
          velocity="${twist_vlimit}"
          lower="${twist_llimit}"
          upper="${twist_ulimit}"/>
      <parent link="${name}_link"/>
      <child link="${attached_link}"/>
    </joint>
  </xacro:macro>

  <!-- "Fixed" part of arm-to-wrist twistable link -->
  <xacro:macro name="crane_x7_rotating_link_2_fixed_part"
      params="name color vlimit llimit ulimit attached_link *origin">
    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/rotating_link_type_2_fixed_part.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/rotating_link_type_2_fixed_part.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>

    <joint name="${name}_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <axis xyz="0 1 0"/>
      <limit effort="30" velocity="${vlimit}" lower="${llimit}" upper="${ulimit}"/>
      <parent link="${name}_link"/>
      <child link="${attached_link}"/>
    </joint>
  </xacro:macro>

  <!-- Rotating part of arm-to-wrist twistable link -->
  <xacro:macro name="crane_x7_rotating_link_2_revolute_part"
      params="name color vlimit llimit ulimit joint_cover_color attached_link *origin">
    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/rotating_link_type_2_revolute_part.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/joint_cover.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${joint_cover_color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/rotating_link_type_2_revolute_part.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/joint_cover.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>

    <joint name="${name}_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <axis xyz="0 1 0"/>
      <limit effort="30" velocity="${vlimit}" lower="${llimit}" upper="${ulimit}"/>
      <parent link="${name}_link"/>
      <child link="${attached_link}"/>
    </joint>
  </xacro:macro>

  <!-- Wrist (end effector attachment link) -->
  <xacro:macro name="crane_x7_wrist"
      params="name color vlimit llimit ulimit attached_link *origin">
    <link name="${name}_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/visual/wrist.stl"
              scale="1 1 1"/>
        </geometry>
        <material name="${color}"/>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://crane_x7_description/meshes/collision/wrist.stl"
              scale="1 1 1"/>
        </geometry>
      </collision>

      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="1" ixy="0.0" ixz="0.0"
          iyy="1" iyz="0.0"
          izz="1"/>
      </inertial>
    </link>

    <joint name="${name}_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <axis xyz="0 0 1"/>
      <limit effort="30" velocity="${vlimit}" lower="${llimit}" upper="${ulimit}"/>
      <parent link="${name}_link"/>
      <child link="${attached_link}"/>
    </joint>
  </xacro:macro>
</robot>
